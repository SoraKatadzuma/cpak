project:
  name: cpak
  gpid: SoraKatadzuma
  semv: 1.0.0-alpha+dev
  desc: >
    Compile and Package (CPak) is a build tool with an
    emphasis on configuration as code and extensibility.
  home: https://github.com/SoraKatadzuma/cpak
  issues: https://github.com/SoraKatadzuma/cpak/issues
  license: MIT
  authors:
  - John Christman dungeonsandanime@gmail.com

options:
- name: CPAK_BUILD_TESTS
  desc: "Whether to build the tests for CPak."
  value: false

- name: CPAK_BUILD_SAMPLES
  desc: "Whether to build the samples for CPak."
  value: false

# All dependencies are forked to include their own CPakFiles.
dependencies:
- SoraKatadzuma/argparse@1.0.0
- SoraKatadzuma/cpp-semver@1.0.0
- SoraKatadzuma/cpp-subprocess@1.0.0
- SoraKatadzuma/googletest@1.0.0
- SoraKatadzuma/spdlog@1.0.0
- SoraKatadzuma/yaml-cpp@1.0.0

interfaces:
- name: cpak::testing
  inherits: [ !private gtest::gtest ]
  libraries: [ !private cpak::core ]

targets:
- name: cpak::core
  type: archive
  inherits:
  - argparse::argparse
  - semver::semver
  - subprocess::subprocess
  - spdlog::spdlog
  - yamlcpp::yamlcpp
  libraries:
  - stdc++fs
  options:
  - "${if:$CPAK_PROFILE == 'Debug'   ? '-g'  : ''}"
  - "${if:$CPAK_PROFILE == 'Release' ? '-O2' : '-O0'}"
  - "-Wall -Wextra -Wpedantic -Werror"
  sources:
  - source/application.cpp
  - source/errorcode.cpp
  - source/management.cpp
  - source/pipeline.cpp

- name: cpak
  type: executable
  libraries: [ cpak::core ]
  sources: [ source/entry.cpp ]

tests:
  enabled: "${CPAK_BUILD_TESTS}"
  inherits: [ cpak::testing ]
  targets:
  - tests/checksum_tests.cpp
  - tests/cpakfile_tests.cpp
  - tests/dependency_tests.cpp
  - tests/management_tests.cpp
  - tests/option_tests.cpp
  - tests/project_tests.cpp
  - tests/repository_tests.cpp
  - tests/target_tests.cpp
